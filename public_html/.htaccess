# EyeTrip VR - WebXR 360Â° Video Streaming Configuration
# ======================================================

# Enable video streaming with Range Requests (critical for large files)
<IfModule mod_headers.c>
    # Enable Range Requests for partial content delivery
    Header set Accept-Ranges bytes
    
    # Cache optimization for video files
    <FilesMatch "\.(mp4|webm|m3u8|ts)$">
        # Cache videos for 1 week (604800 seconds)
        Header set Cache-Control "public, max-age=604800, immutable"
        
        # Allow revalidation for manifest files
        <FilesMatch "\.(m3u8)$">
            Header set Cache-Control "public, max-age=60"
        </FilesMatch>
    </FilesMatch>
    
    # CORS headers for WebXR (required for cross-origin video textures)
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, HEAD, OPTIONS"
    Header set Access-Control-Allow-Headers "Range, Content-Type"
    Header set Access-Control-Expose-Headers "Content-Length, Content-Range, Accept-Ranges"
    
    # Handle preflight OPTIONS requests
    <FilesMatch "\.(mp4|webm|m3u8|ts)$">
        Header set Access-Control-Max-Age "3600"
    </FilesMatch>
</IfModule>

# Enable GZIP compression for text-based files (not videos)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
    AddOutputFilterByType DEFLATE text/javascript application/javascript application/json
    AddOutputFilterByType DEFLATE application/x-javascript application/xml application/xml+rss
    AddOutputFilterByType DEFLATE application/vnd.apple.mpegurl
    
    # Don't compress already-compressed files
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|mp4|webm|ts)$ no-gzip dont-vary
</IfModule>

# Proper MIME types for video streaming
<IfModule mod_mime.c>
    # Video formats
    AddType video/mp4 .mp4
    AddType video/webm .webm
    
    # HLS streaming
    AddType application/vnd.apple.mpegurl .m3u8
    AddType video/mp2t .ts
    
    # Web fonts (for UI)
    AddType application/font-woff2 .woff2
    AddType application/font-woff .woff
    
    # JSON
    AddType application/json .json
</IfModule>

# Enable KeepAlive for better streaming performance
<IfModule mod_headers.c>
    Header set Connection keep-alive
</IfModule>

# Prevent directory listing
Options -Indexes

# Custom error pages (optional)
ErrorDocument 404 /index.html

# Security headers
<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"
    
    # Enable XSS protection
    Header set X-XSS-Protection "1; mode=block"
    
    # Frame options for WebXR
    Header set X-Frame-Options "SAMEORIGIN"
</IfModule>

# Optimize file serving
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Videos
    ExpiresByType video/mp4 "access plus 1 week"
    ExpiresByType video/webm "access plus 1 week"
    ExpiresByType application/vnd.apple.mpegurl "access plus 1 minute"
    ExpiresByType video/mp2t "access plus 1 week"
    
    # Images
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    
    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    
    # HTML
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# Handle .mp4 range requests properly
<FilesMatch "\.(mp4|webm)$">
    # Ensure proper byte-range support
    SetEnv no-gzip 1
</FilesMatch>
