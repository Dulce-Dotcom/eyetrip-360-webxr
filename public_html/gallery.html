<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Gallery - EyeTrip VR</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="EyeTrip VR">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EyeTrip VR">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" href="images/eyetripvr-icon.png">
    <link rel="apple-touch-icon" href="images/eyetripvr-icon.png">
    <link rel="stylesheet" href="css/eyetrip-style.css">
    <link rel="stylesheet" href="css/app.css">
    
    <!-- Mobile-Only Performance Fixes (Does not affect Desktop/VR) -->
    <link rel="stylesheet" href="css/mobile-fixes.css">
    
    <!-- Wallet Widget Styles -->
    <link rel="stylesheet" href="css/wallet-widget.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: #1b2a41;
        }

        body {
            background: 
                linear-gradient(to bottom, rgba(1, 1, 155, 0.7), rgba(27, 42, 65, 0.8)),
                url('assets/thumbnails/eyetrip-test-video2-optimized.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            background-blend-mode: overlay;
            min-height: 100vh;
        }

        .header {
            background: rgba(27, 42, 65, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(240, 248, 255, 0.1);
        }

        .logo img {
            height: 50px;
            width: auto;
            filter: brightness(0) invert(1) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.8));
            transition: all 0.3s ease;
        }
        
        .logo img:hover {
            filter: brightness(0) invert(1) drop-shadow(0 6px 12px rgba(205, 0, 255, 0.6));
            transform: translateY(-2px);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: #f0f8ff;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: rgba(205, 0, 255, 0.2);
            color: #cd00ff;
        }

        .mobile-menu-toggle {
            display: none;
        }

        .gallery-container {
            padding: 6rem 2rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 2rem;
            padding: 1.5rem;
            background: rgba(27, 42, 65, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(240, 248, 255, 0.2);
        }
        
        .filter-group {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .filter-btn {
            padding: 0.5rem 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(205, 0, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .search-group {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
        }
        
        #searchInput {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-radius: 25px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }
        
        #searchInput:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        #searchInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Completion Badge */
        .completion-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.5);
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .progress-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.5);
            z-index: 10;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            justify-items: center;
        }

        .video-card {
            background: rgba(27, 42, 65, 0.85);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            border: 1px solid rgba(240, 248, 255, 0.2);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .video-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 45px rgba(205, 0, 255, 0.4);
            border-color: rgba(205, 0, 255, 0.5);
        }

        .video-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
            flex-shrink: 0;
        }

        .video-info {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .video-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .video-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .video-duration {
            display: inline-block;
            background: rgba(0, 0, 0, 0.7);
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .play-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
        }

        .play-button:hover {
            background: linear-gradient(45deg, #ff5252, #ff7777);
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-wrap: wrap;
            }

            .mobile-menu-toggle {
                display: block;
                background: none;
                border: none;
                color: #f0f8ff;
                font-size: 1.8rem;
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 8px;
                transition: all 0.3s ease;
            }

            .nav-links {
                display: none;
                width: 100%;
                flex-direction: column;
                gap: 0;
                margin-top: 1rem;
                background: rgba(27, 42, 65, 0.98);
                border-radius: 8px;
                padding: 0.5rem 0;
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links a {
                width: 100%;
                text-align: center;
                padding: 1rem;
                font-size: 0.9rem;
                border-radius: 0;
            }

            .logo img {
                height: 35px;
            }

            .gallery-container {
                padding: 5rem 1rem 2rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
                padding: 0 0.5rem;
            }

            /* Sound Hunt Section Mobile Styles */
            .sound-hunt-section {
                margin-top: 2rem !important;
                padding: 0 1rem !important;
            }

            .sound-hunt-section h2 {
                font-size: 1.8rem !important;
                margin-bottom: 0.75rem !important;
            }

            .sound-hunt-section p {
                font-size: 1rem !important;
                line-height: 1.5 !important;
                padding: 0 0.5rem !important;
            }

            /* Sound Hunt Cards Mobile Optimization */
            .video-card {
                border-radius: 12px;
                margin-bottom: 0.5rem;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
            }

            .video-card:active {
                transform: scale(0.98);
            }

            .video-thumbnail {
                height: 180px;
            }

            .video-info {
                padding: 1rem;
            }

            .video-title {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }

            .video-duration {
                font-size: 0.85rem;
                padding: 0.2rem 0.4rem;
                margin-bottom: 0.75rem;
            }

            .video-description {
                font-size: 0.9rem;
                line-height: 1.4;
                margin-bottom: 0.75rem;
                /* Limit text to 3 lines on mobile */
                display: -webkit-box;
                -webkit-line-clamp: 3;
                line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .play-button {
                padding: 0.65rem 1.5rem;
                font-size: 0.95rem;
                border-radius: 20px;
            }

            /* Touch-friendly tap targets */
            .video-card {
                min-height: 320px;
            }

            /* Creator Philosophy Section Mobile */
            .sound-hunt-section + div + div {
                padding: 1.5rem 1rem !important;
                margin: 2rem 1rem 2rem 1rem !important;
            }

            .sound-hunt-section + div + div h2 {
                font-size: 1.6rem !important;
                margin-bottom: 1rem !important;
            }

            .sound-hunt-section + div + div p {
                font-size: 1rem !important;
                line-height: 1.6 !important;
            }

            .sound-hunt-section + div + div blockquote {
                padding: 0.75rem 1rem !important;
                margin: 1rem auto !important;
            }

            .sound-hunt-section + div + div blockquote p {
                font-size: 0.95rem !important;
                line-height: 1.5 !important;
            }

            .sound-hunt-section + div + div blockquote footer {
                font-size: 0.85rem !important;
            }
        }

        @media (min-width: 769px) and (max-width: 1200px) {
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
    <div class="header">
        <a href="index.html" class="logo">
            <img src="images/eyetripimagesvr-wide.svg?v=2" alt="EyeTripVR">
        </a>
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
        <div class="nav-links" id="navLinks">
            <a href="gallery.html">Gallery</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
        </div>
    </div>
    
    <script>
        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const header = document.querySelector('.header');
            const navLinks = document.getElementById('navLinks');
            const toggle = document.querySelector('.mobile-menu-toggle');
            
            if (!header.contains(event.target) && navLinks.classList.contains('active')) {
                navLinks.classList.remove('active');
            }
        });
        
        // Close menu when clicking a nav link
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', function() {
                const navLinks = document.getElementById('navLinks');
                navLinks.classList.remove('active');
            });
        });
    </script>

    <div class="gallery-container">
        <h1 class="page-title">VR Video Gallery</h1>
        
        <!-- AFFIRMATION EXPERIENCES SECTION (MOVED TO TOP) -->
        <div class="affirmation-section" style="margin-top: 2rem; margin-bottom: 5rem; padding: 0 2rem;">
            <div style="text-align: center; margin-bottom: 3rem;">
                <h2 style="font-size: 2.8rem; margin-bottom: 1rem; font-weight: 700;">
                    <span style="margin-right: 0.5rem;">‚ú®</span>
                    <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">Affirmation Experiences</span>
                </h2>
                <p style="color: rgba(240, 248, 255, 0.85); max-width: 700px; margin: 0 auto; font-size: 1.2rem; line-height: 1.6;">
                    Personalized affirmation journeys powered by <strong>ElevenLabs AI</strong>. Each experience generates unique voice affirmations based on your emotional state and intentions.
                </p>
                <div style="display: inline-flex; align-items: center; gap: 0.5rem; margin-top: 1rem; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); padding: 0.75rem 1.5rem; border-radius: 24px;">
                    <span style="color: rgba(240, 248, 255, 0.7); font-size: 0.95rem;">Powered by</span>
                    <strong style="color: #667eea; font-size: 1.1rem;">ElevenLabs</strong>
                </div>
            </div>

            <div id="affirmationGrid" style="display: flex; justify-content: center; margin: 0 auto; max-width: 1400px;">
                <!-- Single Personalized Affirmation Journey Card -->
                <div class="video-card affirmation-card" onclick="startAffirmationExperience()" style="cursor: pointer; width: 100%;">
                    <div style="position: relative; overflow: hidden; border-radius: 12px;">
                        <!-- Animated gradient background -->
                        <div style="
                            position: absolute;
                            width: 100%;
                            height: 140px;
                            background: linear-gradient(135deg, 
                                rgba(102, 126, 234, 0.9), 
                                rgba(118, 75, 162, 0.9), 
                                rgba(255, 107, 107, 0.9));
                            background-size: 200% 200%;
                            animation: gradientShift 8s ease infinite;
                        "></div>
                        
                        <!-- Overlay content -->
                        <div style="
                            position: relative;
                            height: 140px;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            text-align: center;
                            z-index: 1;
                        ">
                            <div style="font-size: 28px; font-weight: bold; text-shadow: 0 2px 8px rgba(0,0,0,0.3); margin-bottom: 8px;">‚ú® Personalized Affirmation Journey</div>
                            <div style="font-size: 16px; opacity: 0.95; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">AI-Powered ‚Ä¢ Tailored to Your Emotions</div>
                        </div>
                    </div>
                    
                    <div class="video-info">
                        <h3 class="video-title" style="font-size: 1.5rem;">‚ú® Your Personalized Journey</h3>
                        <div class="video-duration">üé§ ElevenLabs AI ‚Ä¢ üé® 4 Unique Videos ‚Ä¢ ‚ú® 10 Affirmations</div>
                        <p class="video-description">
                            Take a quick 3-question survey to generate AI affirmations tailored to your emotional needs. 
                            Experience them in an immersive 360¬∞ environment selected just for you based on your mood and intentions.
                        </p>
                        <p class="video-description" style="margin-top: 1rem; font-style: italic; opacity: 0.9;">
                            <strong>How it works:</strong> Answer questions about your emotional state ‚Üí AI generates personalized affirmations ‚Üí 
                            We select the perfect 360¬∞ video to match your vibe ‚Üí Find and discover your affirmations hidden in the experience ‚Üí Download your full affirmation audio
                        </p>
                        <button class="play-button" style="background: linear-gradient(135deg, #667eea, #764ba2); font-size: 1.1rem; padding: 0.75rem 2rem;">
                            ‚ú® Start Your Journey
                        </button>
                    </div>
                </div>
            </div>
            
            <style>
                @keyframes gradientShift {
                    0% { background-position: 0% 50%; }
                    50% { background-position: 100% 50%; }
                    100% { background-position: 0% 50%; }
                }
                
                .affirmation-card:hover > div:first-child > div:first-child {
                    transform: scale(1.05);
                    transition: transform 0.5s ease;
                }
            </style>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar" style="margin: 3rem auto 2rem; max-width: 1400px;">
            <div class="filter-group">
                <label>Status:</label>
                <button class="filter-btn active" data-filter="all" onclick="filterGallery('all')">All</button>
                <button class="filter-btn" data-filter="completed" onclick="filterGallery('completed')">‚úì Completed</button>
                <button class="filter-btn" data-filter="incomplete" onclick="filterGallery('incomplete')">In Progress</button>
            </div>
            <div class="search-group">
                <input type="search" id="searchInput" placeholder="üîç Search experiences..." oninput="searchGallery()">
            </div>
        </div>

        <!-- SOUND HUNT EXPERIENCES SECTION -->
        <div class="sound-hunt-section" style="margin-top: 3rem; padding: 0 2rem;">
            <div style="text-align: center; margin-bottom: 3rem;">
                <h2 style="font-size: 2.8rem; margin-bottom: 1rem; font-weight: 700;">
                    <span style="margin-right: 0.5rem;">üéØ</span>
                    <span style="background: linear-gradient(135deg, #cd00ff 0%, #ff6ec7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 4px 12px rgba(205, 0, 255, 0.3);">Sound Hunt Experiences</span>
                </h2>
                <p style="color: rgba(240, 248, 255, 0.85); max-width: 700px; margin: 0 auto; font-size: 1.2rem; line-height: 1.6;">
                    Explore immersive 360¬∞ worlds and discover hidden sound hotspots. Find all the audio treasures in each unique environment.
                </p>
            </div>
        </div>
        
        <div class="gallery-grid" id="galleryGrid">
            <!-- Video 1: Matrix Caracas Sphere -->
            <div class="video-card" data-video-id="matrixCaracasSphere_1" data-title="Matrix Caracas" onclick="window.location.href='video1.html'">
                <img src="assets/videos/processed/matrixCaracasSphere_1/matrixCaracasSphere_1_thumb.jpg?v=2" alt="Matrix Caracas Sphere" class="video-thumbnail">
                <div class="video-info">
                    <h3 class="video-title">Matrix Caracas</h3>
                    <div class="video-duration">üïê 4:17</div>
                    <p class="video-description">
                        An ultra-high resolution photograph of a water fountain is transformed into a digital dreamscape. With music "Caracas" by Phil Manzanera from the album Primitive Guitars
                    </p>
                    <button class="play-button">
                        üé¨ Play in VR
                    </button>
                </div>
            </div>

            <!-- Video 2: Scraptangle -->
            <div class="video-card" data-video-id="Scraptangle_latlong_05b_offsetOverture1" data-title="Scraptangle" onclick="window.location.href='video2.html'">
                <img src="assets/videos/processed/Scraptangle_latlong_05b_offsetOverture1/Scraptangle_latlong_05b_offsetOverture1_thumb.jpg?v=2" alt="Scraptangle" class="video-thumbnail">
                <div class="video-info">
                    <h3 class="video-title">Scraptangle</h3>
                    <div class="video-duration">üïê 5:36</div>
                    <p class="video-description">
                        A pile of scrap metal reveals incredible detail hiding in the rust. A unique VR experience that pushes creative boundaries. With music "Overture.All Roads" by Perry Vasquez
                    </p>
                    <button class="play-button">
                        üé¨ Play in VR
                    </button>
                </div>
            </div>

            <!-- Video 3: Shroom Zoom -->
            <div class="video-card" data-video-id="ShroomZoomLatlong_12" data-title="Shroom Zoom" onclick="window.location.href='video3.html'">
                <img src="assets/videos/processed/ShroomZoomLatlong_12/ShroomZoomLatlong_12_thumb.jpg?v=2" alt="Shroom Zoom" class="video-thumbnail">
                <div class="video-info">
                    <h3 class="video-title">Shroom Zoom</h3>
                    <div class="video-duration">üïê 5:23</div>
                    <p class="video-description">
                        Explore an innocent-looking bunch of mushrooms in this captivating 360¬∫ exploration of the natural world. With music by Peter Gabriel from the album Passion: Music for The Last Temptation of Christ
                    </p>
                    <button class="play-button">
                        üé¨ Play in VR
                    </button>
                </div>
            </div>

            <!-- Video 4: Stumpy Waves -->
            <div class="video-card" data-video-id="stumpy_latlong_01_waves_61Mbps-003" data-title="Stumpy Waves" onclick="window.location.href='video4.html'">
                <img src="assets/videos/processed/stumpy_latlong_01_waves_61Mbps-003/stumpy_latlong_01_waves_61Mbps-003_thumb.jpg?v=2" alt="Stumpy Waves" class="video-thumbnail">
                <div class="video-info">
                    <h3 class="video-title">Stumpy Waves</h3>
                    <div class="video-duration">üïê 5:25</div>
                    <p class="video-description">
                        Find fascination in an unlikely old tree stump. Perhaps it will give up its secrets! With music "Waves Part I" & "Waves Part II" from the album Waves by Jade Warrior.
                    </p>
                    <button class="play-button">
                        üé¨ Play in VR
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Creator Philosophy Section -->
        <div style="max-width: 900px; margin: 4rem auto 3rem auto; padding: 2rem; background: rgba(27, 42, 65, 0.9); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(240, 248, 255, 0.2); text-align: center;">
            <h2 style="font-size: 2.5rem; margin-bottom: 1.5rem; font-weight: 700;">
                <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">FROM ANXIOUS TO CENTERED</span>
            </h2>
            <p style="color: rgba(240, 248, 255, 0.9); font-size: 1.15rem; line-height: 1.8; margin-bottom: 1.5rem;">
                Created by Academy Award winner and clinical hypnotherapist 
                <strong style="color: #f0f8ff;">David Aughenbaugh</strong>, EyeTrip VR uses spatial audio, interactive 
                discovery, and flow-state visuals to transform your mental state.
            </p>
            <blockquote style="border-left: 4px solid rgba(102, 126, 234, 0.6); padding: 1rem 1.5rem; margin: 1.5rem auto; background: rgba(102, 126, 234, 0.1); border-radius: 8px; max-width: 700px;">
                <p style="color: rgba(240, 248, 255, 0.95); font-size: 1.1rem; font-style: italic; line-height: 1.7; margin: 0;">
                    "My work quiets the thinking mind and promotes flow states 
                    of focused attention and creativity."
                </p>
                <footer style="color: rgba(240, 248, 255, 0.7); font-size: 0.95rem; margin-top: 0.75rem; text-align: right;">
                    ‚Äî David Aughenbaugh
                </footer>
            </blockquote>
        </div>
    </div>

    <script>
        // Add completion badges on page load
        document.addEventListener('DOMContentLoaded', function() {
            showCompletionBadges();
        });
        
        // Show completion badges for completed videos
        function showCompletionBadges() {
            const cards = document.querySelectorAll('.video-card');
            cards.forEach(card => {
                const videoId = card.getAttribute('data-video-id');
                if (!videoId) return;
                
                // Check if completed
                const completed = localStorage.getItem(`completed_${videoId}`);
                
                // Check for progress
                const progressData = localStorage.getItem(`progress_${videoId}`);
                let progress = null;
                if (progressData) {
                    try {
                        progress = JSON.parse(progressData);
                    } catch (e) {}
                }
                
                // Remove existing badges
                const existingBadge = card.querySelector('.completion-badge, .progress-badge');
                if (existingBadge) existingBadge.remove();
                
                // Add appropriate badge
                if (completed === 'true' || (progress && progress.completed)) {
                    const badge = document.createElement('div');
                    badge.className = 'completion-badge';
                    badge.innerHTML = '‚úì Completed';
                    card.appendChild(badge);
                    card.setAttribute('data-status', 'completed');
                } else if (progress && progress.discoveredHotspots && progress.discoveredHotspots.length > 0) {
                    const badge = document.createElement('div');
                    badge.className = 'progress-badge';
                    badge.innerHTML = `${progress.discoveredHotspots.length}/${progress.totalHotspots} üéµ`;
                    card.appendChild(badge);
                    card.setAttribute('data-status', 'incomplete');
                } else {
                    card.setAttribute('data-status', 'incomplete');
                }
            });
        }
        
        // Filter gallery by status
        let currentFilter = 'all';
        function filterGallery(filter) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-filter') === filter) {
                    btn.classList.add('active');
                }
            });
            
            // Filter cards
            const cards = document.querySelectorAll('.video-card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                const status = card.getAttribute('data-status');
                
                if (filter === 'all') {
                    card.style.display = '';
                    visibleCount++;
                } else if (filter === 'completed' && status === 'completed') {
                    card.style.display = '';
                    visibleCount++;
                } else if (filter === 'incomplete' && status === 'incomplete') {
                    card.style.display = '';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Show/hide no results message
            showNoResults(visibleCount === 0);
        }
        
        // Search gallery
        function searchGallery() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.video-card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                const title = card.getAttribute('data-title').toLowerCase();
                const description = card.querySelector('.video-description').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    // Only show if it matches current filter
                    const status = card.getAttribute('data-status');
                    if (currentFilter === 'all' || 
                        (currentFilter === 'completed' && status === 'completed') ||
                        (currentFilter === 'incomplete' && status === 'incomplete')) {
                        card.style.display = '';
                        visibleCount++;
                    }
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Show/hide no results message
            showNoResults(visibleCount === 0);
        }
        
        // Show/hide no results message
        function showNoResults(show) {
            let noResultsMsg = document.getElementById('noResultsMessage');
            
            if (show) {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('div');
                    noResultsMsg.id = 'noResultsMessage';
                    noResultsMsg.style.cssText = `
                        text-align: center;
                        padding: 60px 20px;
                        font-size: 1.2rem;
                        color: rgba(255, 255, 255, 0.7);
                        grid-column: 1 / -1;
                    `;
                    noResultsMsg.innerHTML = `
                        <div style="font-size: 3rem; margin-bottom: 20px;">üîç</div>
                        <div>No experiences found.</div>
                        <div style="font-size: 1rem; margin-top: 10px;">Try a different search or filter.</div>
                    `;
                    document.querySelector('.video-grid').appendChild(noResultsMsg);
                }
                noResultsMsg.style.display = 'block';
            } else {
                if (noResultsMsg) {
                    noResultsMsg.style.display = 'none';
                }
            }
        }
        
        // Simple hover effects for video cards
        document.querySelectorAll('.video-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-10px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
    </script>
    
    <!-- Affirmation Experience Integration -->
    <script type="module">
        import { AffirmationSurvey } from './js/modules/AffirmationSurvey.js';
        import { ElevenLabsService } from './js/modules/ElevenLabsService.js';
        
        console.log('‚ú® Initializing affirmation system on gallery...');
        
        // Store affirmation state globally
        window.affirmationState = {
            survey: new AffirmationSurvey(),
            elevenlabs: new ElevenLabsService(),
            currentExperience: null
        };
        
        console.log('‚úÖ Affirmation services created');
        
        // Function called when user clicks the ONE affirmation card
        window.startAffirmationExperience = function() {
            console.log('üéØ Starting personalized affirmation experience');
            
            // CHECK WALLET CONNECTION (Demo Mode - Just checks, doesn't require payment)
            if (window.walletManager && window.walletManager.demoMode) {
                console.log('üé≠ Demo Mode: Wallet check (no payment required)');
                
                if (!window.walletManager.isConnected()) {
                    showNotification('üí° Connect your MetaMask wallet to preview the payment flow!\n(No actual payment required in demo mode)', 'warning');
                    // Still allow access in demo mode
                } else {
                    console.log('‚úÖ Wallet connected:', window.walletManager.getUserAddress());
                    showNotification('‚úÖ Wallet connected! Proceeding to affirmations...', 'success');
                }
            }
            
            // IMPORTANT: Create and activate AudioContext IMMEDIATELY during the click
            // This ensures browser allows audio without user gesture issues
            console.log('üéº Pre-creating audio context during click...');
            const ctx = window.affirmationState.elevenlabs.getAudioContext();
            if (ctx.state === 'suspended') {
                ctx.resume().then(() => {
                    console.log('üéµ Audio context activated on click');
                }).catch(err => {
                    console.warn('‚ö†Ô∏è Could not activate audio context on click:', err);
                });
            }
            
            console.log('üìã Showing survey...');
            
            // Show the survey
            window.affirmationState.survey.show(async (responses) => {
                console.log('üìã Survey completed:', responses);
                
                try {
                    // Hide survey first
                    window.affirmationState.survey.hide();
                    
                    // SELECT VIDEO BASED ON SURVEY RESPONSES
                    const videoName = selectVideoForMood(responses);
                    console.log(`üé• Selected video: ${videoName} based on mood`);
                    
                    // Build video path
                    const videoPath = `assets/videos/processed/${videoName}/${videoName}_1080p.mp4`;
                    const videoTitle = getVideoTitle(videoName, responses);
                    
                    // Store the experience details
                    window.affirmationState.currentExperience = {
                        id: 'personalized',
                        title: videoTitle,
                        videoSrc: videoPath,
                        videoName: videoName,
                        targetPage: 'affirmation1.html'
                    };
                    
                    console.log('üé¨ Experience:', window.affirmationState.currentExperience);
                    
                    // Show progress overlay
                    const progressOverlay = showProgressOverlay();
                    
                    // Step 1: Preparing affirmations
                    updateProgress(progressOverlay, 1, 'Selecting your personalized affirmations...');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Step 2: Generate affirmations with ElevenLabs (ONE optimized call)
                    updateProgress(progressOverlay, 2, 'Connecting to AI voice service...');
                    console.log('üé§ Starting OPTIMIZED ElevenLabs generation (single MP3)...');
                    console.log('üìã Survey responses:', responses);
                    
                    // Connect progress callback to our progress overlay
                    window.affirmationState.elevenlabs.setProgressCallback((message, percent) => {
                        console.log(`üìä Progress: ${percent}% - ${message}`);
                        const statusEl = progressOverlay.querySelector('.progress-status');
                        const progressBar = progressOverlay.querySelector('.progress-bar');
                        if (statusEl) statusEl.textContent = message;
                        if (progressBar) progressBar.style.width = `${percent}%`;
                    });
                    
                    const result = await window.affirmationState.elevenlabs.generateAffirmations(responses);
                    
                    console.log(`‚úÖ Generated ${result.affirmations.length} affirmations from single MP3`);
                    console.log(`üéº Full audio: ${result.fullAudio.duration.toFixed(2)}s`);
                    console.log(`üì¶ Sample affirmation:`, {
                        id: result.affirmations[0]?.id,
                        text: result.affirmations[0]?.text.substring(0, 50) + '...',
                        hasBlob: !!result.affirmations[0]?.blob,
                        blobSize: result.affirmations[0]?.blob?.size
                    });
                    
                    // Step 3: Processing audio
                    updateProgress(progressOverlay, 3, 'Processing and splitting audio clips...');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Step 4: Store in sessionStorage for the video page
                    // OPTIMIZED: Only store text + full audio (not individual clips to save space)
                    updateProgress(progressOverlay, 4, 'Preparing your experience...');
                    
                    console.log('üîÑ Converting full audio to base64 for storage...');
                    
                    // Only store affirmation texts (no audio data - we'll use full audio)
                    const affirmationsData = result.affirmations.map(aff => ({
                        id: aff.id,
                        text: aff.text,
                        startTime: aff.startTime,
                        endTime: aff.endTime,
                        duration: aff.duration,
                        playCount: 0,
                        found: false
                    }));
                    
                    console.log(`   üìù Stored ${affirmationsData.length} affirmation texts`);
                    
                    // Convert ONLY full audio to base64
                    if (!result.fullAudio.blob) {
                        console.error('‚ùå Full audio missing blob!');
                        throw new Error('Full audio has no blob data');
                    }
                    
                    const fullAudioBase64 = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.onerror = reject;
                        reader.readAsDataURL(result.fullAudio.blob);
                    });
                    
                    console.log(`   ‚úÖ Full audio: ${Math.round(fullAudioBase64.length / 1024)}KB base64 data`);
                    
                    const dataToStore = {
                        responses: responses,
                        affirmations: affirmationsData,
                        fullAudio: {
                            audioDataBase64: fullAudioBase64,  // Store base64
                            duration: result.fullAudio.duration
                        },
                        metadata: result.metadata,
                        experience: window.affirmationState.currentExperience,
                        timestamp: Date.now()
                    };
                    
                    console.log('üíæ Storing affirmation data in sessionStorage...');
                    console.log(`üì¶ Data structure:`, {
                        responsesKeys: Object.keys(dataToStore.responses),
                        affirmationCount: dataToStore.affirmations.length,
                        hasFullAudio: !!dataToStore.fullAudio.audioDataBase64,
                        experienceId: dataToStore.experience.id,
                        dataSize: JSON.stringify(dataToStore).length
                    });
                    
                    sessionStorage.setItem('affirmationData', JSON.stringify(dataToStore));
                    
                    // Verify storage worked
                    const stored = sessionStorage.getItem('affirmationData');
                    if (stored) {
                        console.log('‚úÖ sessionStorage.setItem() successful');
                        console.log('üìä Verification:');
                        console.log('   - Storage exists:', !!stored);
                        console.log('   - Storage size:', stored.length, 'characters');
                        console.log('   - Can parse:', (() => { try { JSON.parse(stored); return true; } catch(e) { return false; }})());
                        
                        // Double check it's accessible
                        const doubleCheck = sessionStorage.getItem('affirmationData');
                        console.log('   - Double-check exists:', !!doubleCheck);
                        console.log('   - Same data:', stored === doubleCheck);
                    } else {
                        console.error('‚ùå sessionStorage.setItem() FAILED!');
                        console.error('   This is a critical error - data was not saved!');
                        throw new Error('Failed to save affirmation data to sessionStorage');
                    }
                    
                    // Step 5: Complete!
                    updateProgress(progressOverlay, 5, 'All set! Launching your journey...');
                    await new Promise(resolve => setTimeout(resolve, 800));
                    
                    // FINAL CHECK before redirect
                    console.log('üîç FINAL CHECK BEFORE REDIRECT:');
                    const finalCheck = sessionStorage.getItem('affirmationData');
                    console.log('   - sessionStorage still has data:', !!finalCheck);
                    console.log('   - Data length:', finalCheck?.length || 0);
                    
                    // Redirect to the affirmation video page
                    const targetPage = window.affirmationState.currentExperience.targetPage;
                    console.log(`üöÄ ========================================`);
                    console.log(`üöÄ REDIRECTING NOW`);
                    console.log(`ÔøΩ ========================================`);
                    console.log(`   - From: ${window.location.href}`);
                    console.log(`   - To: ${targetPage}`);
                    console.log(`   - Full URL will be: ${window.location.origin}/${targetPage}`);
                    console.log(`   - sessionStorage has data: ${!!sessionStorage.getItem('affirmationData')}`);
                    console.log(`üöÄ ========================================`);
                    
                    // Use setTimeout to ensure all console logs are flushed
                    setTimeout(() => {
                        console.log(`‚è∞ Executing redirect to ${targetPage} NOW...`);
                        window.location.href = targetPage;
                    }, 100);
                    
                } catch (error) {
                    console.error('‚ùå Error generating affirmations:', error);
                    console.error('Stack trace:', error.stack);
                    
                    // Remove progress overlay
                    const progressOverlay = document.querySelector('.affirmation-progress-overlay');
                    if (progressOverlay) {
                        progressOverlay.remove();
                    }
                    
                    alert('Sorry, there was an error generating your affirmations. Please check your internet connection and try again.\n\nError: ' + error.message);
                    window.affirmationState.survey.hide();
                }
            });
        };
        
        // Show progress overlay with steps
        function showProgressOverlay() {
            const overlay = document.createElement('div');
            overlay.className = 'affirmation-progress-overlay';
            // No inline styles - use CSS classes instead
            
            overlay.innerHTML = `
                <div class="progress-card">
                    <div class="progress-icon">üé§</div>
                    <h2 class="progress-title">
                        Crafting Your Personalized Affirmations
                    </h2>
                    <p class="progress-status">
                        Initializing...
                    </p>
                    
                    <!-- Progress Bar -->
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 0%;"></div>
                    </div>
                    
                    <!-- Step Indicators -->
                    <div class="step-indicators">
                        <div class="step-indicator" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">Select</div>
                        </div>
                        <div class="step-indicator" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">Generate</div>
                        </div>
                        <div class="step-indicator" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">Process</div>
                        </div>
                        <div class="step-indicator" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">Prepare</div>
                        </div>
                        <div class="step-indicator" data-step="5">
                            <div class="step-number">5</div>
                            <div class="step-label">Launch</div>
                        </div>
                    </div>
                    
                    <div class="loading-spinner"></div>
                    
                    <p class="progress-footer">
                        Using AI to create unique voice affirmations just for you
                    </p>
                </div>
            `;
            
            document.body.appendChild(overlay);
            setTimeout(() => overlay.style.opacity = '1', 10);
            
            return overlay;
        }
        
        // Update progress
        function updateProgress(overlay, step, message) {
            const statusText = overlay.querySelector('.progress-status');
            const progressBar = overlay.querySelector('.progress-bar');
            const indicators = overlay.querySelectorAll('.step-indicator');
            
            // Update message
            if (statusText) {
                statusText.textContent = message;
            }
            
            // Update progress bar (0-100%)
            const progress = (step / 5) * 100;
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
            
            // Update step indicators - activate current and previous steps
            indicators.forEach((indicator) => {
                const indicatorStep = parseInt(indicator.getAttribute('data-step'));
                if (indicatorStep <= step) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }
        
        console.log('‚úÖ Affirmation system ready - startAffirmationExperience() is now global');
        
        // Helper: Select video based on survey responses
        function selectVideoForMood(responses) {
            const { emotionalTone, currentMood, focusArea } = responses;
            
            // Video mapping based on video characteristics:
            // matrixCaracasSphere_1 - Hypnotic & upbeat (calming, peaceful, meditative)
            // Scraptangle_latlong_05b_offsetOverture1 - Hypnotic & low/groovy (grounding, steady)
            // ShroomZoomLatlong_12 - Chaos & trancey/progressive (energizing, intense, transformative)
            // stumpy_latlong_01_waves_61Mbps-003 - Funky & electric/trippy (uplifting, joyful, playful)
            
            const videoMap = {
                // CALMING combinations - Matrix Caracas (hypnotic & upbeat)
                'calming-anxious': 'matrixCaracasSphere_1',
                'calming-stressed': 'matrixCaracasSphere_1',
                'calming-tired': 'matrixCaracasSphere_1',
                'calming-sad': 'matrixCaracasSphere_1',
                'calming-peaceful': 'matrixCaracasSphere_1',
                'calming-restless': 'matrixCaracasSphere_1',
                'calming-motivated': 'matrixCaracasSphere_1',
                'calming-hopeful': 'matrixCaracasSphere_1',
                
                // GROUNDING combinations - Scraptangle (hypnotic & low/groovy)
                'grounding-anxious': 'Scraptangle_latlong_05b_offsetOverture1',
                'grounding-stressed': 'Scraptangle_latlong_05b_offsetOverture1',
                'grounding-tired': 'Scraptangle_latlong_05b_offsetOverture1',
                'grounding-sad': 'Scraptangle_latlong_05b_offsetOverture1',
                'grounding-peaceful': 'Scraptangle_latlong_05b_offsetOverture1',
                'grounding-restless': 'Scraptangle_latlong_05b_offsetOverture1',
                'grounding-motivated': 'Scraptangle_latlong_05b_offsetOverture1',
                'grounding-hopeful': 'Scraptangle_latlong_05b_offsetOverture1',
                
                // ENERGIZING combinations - Shroom Zoom for intense, Stumpy for positive
                'energizing-anxious': 'ShroomZoomLatlong_12', // Chaos helps release anxiety
                'energizing-stressed': 'ShroomZoomLatlong_12', // Intense to match stress
                'energizing-tired': 'stumpy_latlong_01_waves_61Mbps-003', // Funky to energize
                'energizing-sad': 'stumpy_latlong_01_waves_61Mbps-003', // Uplift sadness
                'energizing-peaceful': 'stumpy_latlong_01_waves_61Mbps-003', // Playful energy
                'energizing-restless': 'ShroomZoomLatlong_12', // Match restless energy
                'energizing-motivated': 'stumpy_latlong_01_waves_61Mbps-003', // Support momentum
                'energizing-hopeful': 'stumpy_latlong_01_waves_61Mbps-003', // Celebrate hope
                
                // UPLIFTING combinations - Stumpy Waves (funky & trippy)
                'uplifting-anxious': 'stumpy_latlong_01_waves_61Mbps-003',
                'uplifting-stressed': 'stumpy_latlong_01_waves_61Mbps-003',
                'uplifting-tired': 'stumpy_latlong_01_waves_61Mbps-003',
                'uplifting-sad': 'stumpy_latlong_01_waves_61Mbps-003',
                'uplifting-peaceful': 'stumpy_latlong_01_waves_61Mbps-003',
                'uplifting-restless': 'stumpy_latlong_01_waves_61Mbps-003',
                'uplifting-motivated': 'stumpy_latlong_01_waves_61Mbps-003',
                'uplifting-hopeful': 'stumpy_latlong_01_waves_61Mbps-003',
                
                // MEDITATIVE combinations - Matrix Caracas (hypnotic & serene)
                'meditative-anxious': 'matrixCaracasSphere_1',
                'meditative-stressed': 'matrixCaracasSphere_1',
                'meditative-tired': 'matrixCaracasSphere_1',
                'meditative-sad': 'matrixCaracasSphere_1',
                'meditative-peaceful': 'matrixCaracasSphere_1',
                'meditative-restless': 'matrixCaracasSphere_1',
                'meditative-motivated': 'matrixCaracasSphere_1',
                'meditative-hopeful': 'matrixCaracasSphere_1',
                
                // TRANSFORMATIVE combinations - Shroom Zoom (chaos & evolution)
                'transformative-anxious': 'ShroomZoomLatlong_12',
                'transformative-stressed': 'ShroomZoomLatlong_12',
                'transformative-tired': 'ShroomZoomLatlong_12',
                'transformative-sad': 'ShroomZoomLatlong_12',
                'transformative-peaceful': 'ShroomZoomLatlong_12',
                'transformative-restless': 'ShroomZoomLatlong_12',
                'transformative-motivated': 'ShroomZoomLatlong_12',
                'transformative-hopeful': 'ShroomZoomLatlong_12'
            };
            
            const key = `${emotionalTone}-${currentMood}`;
            const selectedVideo = videoMap[key] || 'matrixCaracasSphere_1'; // Fallback to Matrix Caracas
            
            console.log('üéØ ========================================');
            console.log('üéØ VIDEO SELECTION DEBUG');
            console.log('üéØ ========================================');
            console.log('üìã Full responses object:', JSON.stringify(responses, null, 2));
            console.log('üéµ Emotional Tone:', emotionalTone);
            console.log('üí≠ Current Mood:', currentMood);
            console.log('üéØ Focus Area:', focusArea);
            console.log('üîë Lookup key:', key);
            console.log('üó∫Ô∏è  Key exists in map?', key in videoMap);
            console.log(`üìπ Video selected: ${selectedVideo}`);
            console.log(`‚úÖ From map? ${videoMap[key] ? 'YES' : 'NO (using fallback)'}`);
            console.log('üéØ ========================================');
            
            return selectedVideo;
        }
        
        // Helper: Get descriptive title for selected video
        function getVideoTitle(videoName, responses) {
            const titles = {
                'matrixCaracasSphere_1': `${responses.emotionalTone.charAt(0).toUpperCase() + responses.emotionalTone.slice(1)} Journey - ${responses.focusArea}`,
                'Scraptangle_latlong_05b_offsetOverture1': `Grounding Journey - ${responses.focusArea}`,
                'ShroomZoomLatlong_12': `Transformative Journey - ${responses.focusArea}`,
                'stumpy_latlong_01_waves_61Mbps-003': `Uplifting Journey - ${responses.focusArea}`
            };
            return titles[videoName] || 'Personalized Journey';
        }
        
        // Add click listeners to affirmation cards as backup
        document.addEventListener('DOMContentLoaded', () => {
            const affirmationCards = document.querySelectorAll('.affirmation-card');
            console.log(`üéØ Found ${affirmationCards.length} affirmation cards`);
            
            affirmationCards.forEach(card => {
                // Remove onclick and add event listener instead
                card.removeAttribute('onclick');
                card.style.cursor = 'pointer';
                
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const id = card.getAttribute('data-affirmation-id');
                    const title = card.getAttribute('data-title');
                    const videoSrc = card.getAttribute('data-video-src');
                    
                    console.log(`üìç Card clicked: ID=${id}, Title=${title}`);
                    
                    if (window.startAffirmationExperience) {
                        window.startAffirmationExperience(parseInt(id), title, videoSrc);
                    } else {
                        console.error('‚ùå startAffirmationExperience not defined!');
                    }
                });
            });
        });
    </script>
    
    <footer class="site-footer">
        <div>&copy; 2025 David Aughenbaugh - EyeTripVR. All rights reserved.</div>
        <div>Powered by <a href="https://dulce.com" target="_blank">Dulce Dotcom</a></div>
    </footer>
    </div> <!-- end .page-wrapper -->
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ [PWA] Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.error('‚ùå [PWA] Service Worker registration failed:', error);
                    });
            });
        }
    </script>
    
    <!-- Mobile-Only Performance Script (Does not affect Desktop/VR) -->
    <script src="js/mobile-performance.js"></script>
    
    <!-- Wallet Connection Widget (Gallery Only) - Collapsible Slide-out -->
    <div class="wallet-widget collapsed">
        <div class="wallet-tab" id="walletTab"></div>
        <div class="wallet-close" id="walletClose">√ó</div>
        <div class="wallet-content">
            <div class="wallet-title">üíé Web3 Wallet</div>
            <button id="walletConnectBtn" onclick="handleWalletConnect()">
                <span>ü¶ä</span>
                <span>Connect Wallet</span>
            </button>
            
            <div id="walletInfo">
                <div class="wallet-info-row">
                    <span class="wallet-info-label">Address:</span>
                    <span class="wallet-info-value" id="walletAddress">-</span>
                </div>
                <div class="wallet-info-row">
                    <span class="wallet-info-label">Network:</span>
                    <span class="wallet-info-value" id="walletNetwork">-</span>
                </div>
                
                <div class="demo-badge">
                    üé≠ DEMO MODE - Active after Chroma Awards
                </div>
            </div>
        </div>
    </div>
    
    <!-- Wallet Connection Script -->
    <script src="js/wallet-connect.js"></script>
    <script>
    // Wallet Widget Collapse/Expand Logic
    const walletWidget = document.querySelector('.wallet-widget');
    const walletTab = document.getElementById('walletTab');
    const walletClose = document.getElementById('walletClose');

    // Toggle collapse state
    function toggleWallet() {
        walletWidget.classList.toggle('collapsed');
    }

    // Expand wallet
    function expandWallet() {
        walletWidget.classList.remove('collapsed');
    }

    // Collapse wallet
    function collapseWallet() {
        walletWidget.classList.add('collapsed');
    }

    // Click on tab to expand
    walletTab.addEventListener('click', expandWallet);

    // Click on close button to collapse
    walletClose.addEventListener('click', collapseWallet);

    // Auto-expand when wallet connects
    const originalHandleWalletConnect = handleWalletConnect;
    
    async function handleWalletConnect() {
        const btn = document.getElementById('walletConnectBtn');
        
        // Always expand when user interacts
        expandWallet();
        
        if (window.walletManager.isConnected()) {
            // Disconnect
            await window.walletManager.disconnectWallet();
            return;
        }
        
        btn.innerHTML = '<span>‚è≥</span><span>Connecting...</span>';
        btn.disabled = true;
        
        const result = await window.walletManager.connectWallet();
        
        btn.disabled = false;
        
        if (result.success) {
            console.log('‚úÖ Connected to wallet:', result.address);
            console.log('üåê Network:', result.network);
            
            // Show success message
            showNotification('‚úÖ Wallet Connected!\n' + result.network, 'success');
            
            // Track event
            if (window.trackVREvent) {
                window.trackVREvent('wallet_connected', result.network, 1);
            }
        } else {
            console.error('‚ùå Connection failed:', result.error);
            btn.innerHTML = '<span>ü¶ä</span><span>Connect Wallet</span>';
            showNotification('‚ùå ' + result.error, 'error');
        }
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: ${type === 'success' ? 'rgba(76, 175, 80, 0.95)' : type === 'error' ? 'rgba(244, 67, 54, 0.95)' : 'rgba(255, 193, 7, 0.95)'};
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            font-weight: 600;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            white-space: pre-line;
            text-align: center;
            max-width: 90%;
            animation: slideDown 0.3s ease;
        `;
        
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideUp 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 4000);
    }
    </script>
</body>
</html>
